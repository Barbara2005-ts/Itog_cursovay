<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–∫–∫–∞—É–Ω—Ç | Memory Mania</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="account.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0/dist/umd/supabase.min.js"></script>

</head>
<body>

    
    <!-- –ñ–∏–≤–æ—Ç–Ω—ã–µ -->
    <div class="animal-container" style="top:5%; left:5%; transform:rotate(-10deg)">
        <img src="character/catcar.png" alt="–ö–æ—Ç –≤ –º–∞—à–∏–Ω–µ" class="floating-image">
        <div class="speech-bubble">–ù–µ –±–æ–π—Å—è —Ä–∞–∑–≥–æ–Ω—è—Ç—å—Å—è ‚Äî —Ç–≤–æ–∏ –∏–¥–µ–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º!</div>
    </div>
    
    <div class="animal-container" style="top:5%; right:5%; transform:rotate(10deg)">
        <img src="character/catplane.png" alt="–ö–æ—Ç –≤ —Å–∞–º–æ–ª–µ—Ç–µ" class="floating-image">
        <div class="speech-bubble">–í–∑–ª–µ—Ç–∞–π –≤—ã—à–µ, –º–µ—á—Ç–∞–π —à–∏—Ä–µ ‚Äî –Ω–µ –±–æ–π—Å—è –≤—ã—Å–æ—Ç—ã!</div>
    </div>
    
    <div class="animal-container" style="top:40%; left:8%; transform:rotate(-5deg)">
        <img src="character/humster.png" alt="–•–æ–º—è–∫" class="floating-image">
        <div class="speech-bubble">–ö–∞–∂–¥–æ–µ –∑–Ω–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Å–µ–º–µ—á–∫–æ, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã—Ä–∞—Å—Ç–µ—Ç —Ç–≤–æ–π —É—Å–ø–µ—Ö!</div>
    </div>
    
    <div class="animal-container" style="bottom:12%; right:8%; transform:rotate(8deg)">
        <img src="character/dog.png" alt="–°–æ–±–∞–∫–∞" class="floating-image">
        <div class="speech-bubble">–°–ª—É—à–∞–π —Å–≤–æ–π –∏–Ω—Å—Ç–∏–Ω–∫—Ç ‚Äî –æ–Ω –ø—Ä–∏–≤–µ–¥–µ—Ç —Ç–µ–±—è –∫ —Å–∞–º—ã–º –≤–∞–∂–Ω—ã–º –æ—Ç–∫—Ä—ã—Ç–∏—è–º!</div>
    </div>
    
    <div class="animal-container" style="bottom:12%; left:8%; transform:rotate(-8deg)">
        <img src="character/enot.png" alt="–ï–Ω–æ—Ç" class="floating-image">
        <div class="speech-bubble">–ë—É–¥—å –ª–æ–≤–∫–∏–º –∏ –Ω–∞—Ö–æ–¥—á–∏–≤—ã–º ‚Äî –∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ–º!</div>
    </div>
    
    <div class="animal-container" style="top:40%; right:8%; transform:rotate(5deg)">
        <img src="character/rabbit.png" alt="–ö—Ä–æ–ª–∏–∫" class="floating-image">
        <div class="speech-bubble">–ù–µ –±–æ–π—Å—è –ø—Ä—ã–≥–∞—Ç—å –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç—å ‚Äî –≤–ø–µ—Ä–µ–¥–∏ —Ç–µ–±—è –∂–¥—É—Ç –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã!</div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞ -->
    <div class="account-wrapper">
        <h1>–¢–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</h1>
        <p><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> <span id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>

        <!-- –ê–≤–∞—Ç–∞—Ä -->
        <div class="avatar-section">
            <h2>–ê–≤–∞—Ç–∞—Ä</h2>
            <img id="current-avatar" src="avatars/user.png" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar-img">
            <div class="avatar-options">
                <img src="avatars/girl.png" onclick="changeAvatar(this.src)" class="avatar-option">
                <img src="avatars/boy.png" onclick="changeAvatar(this.src)" class="avatar-option">
                <img src="avatars/cat.png" onclick="changeAvatar(this.src)" class="avatar-option">
            </div>
        </div>

        <div class="stats-section">
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <ul class="stats-list">
                <p><strong>–û–±—â–∏–µ –æ—á–∫–∏:</strong> <span id="total-points">0</span></p>
                <p><strong>–í—Å–µ–≥–æ —É—Ä–æ–≤–Ω–µ–π –ø—Ä–æ–π–¥–µ–Ω–æ:</strong> <span id="total-levels">0</span></p>
            </ul>
        
            <h2>–ò–≥—Ä—ã</h2>
            <ul class="game-stats">
                <p>üé® –¶–≤–µ—Ç–Ω—ã–µ –í—Å–ø—ã—à–∫–∏ ‚Äî <span id="flash-points">0</span> –æ—á–∫–æ–≤, <span id="flash-levels">0</span> —É—Ä–æ–≤–Ω–µ–π</p>
                <p>üîç –ü–æ—Ç–µ—Ä—è—à–∫–∏ ‚Äî <span id="lost-points">0</span> –æ—á–∫–æ–≤, <span id="lost-levels">0</span> —É—Ä–æ–≤–Ω–µ–π</p>
                <p>üß† –ü–∞—Ä–æ—á–∫–∏ ‚Äî <span id="pairs-points">0</span> –æ—á–∫–æ–≤, <span id="pairs-levels">0</span> —É—Ä–æ–≤–Ω–µ–π</p>
            </ul>
        </div>
        
    </div>

    <script>
        const supabase = supabase.createClient('https://rjhqvhwlwdhpbrtytxxp.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJqaHF2aHdsd2RocGJydHl0eHhwIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NTI2OTA2MywiZXhwIjoyMDYwODQ1MDYzfQ.G8dLZZu9b7FHOZmwFDun4tN50oXtPt2NxHspnTo6xT0');

        window.onload = async function () {
            // –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
            const savedAvatar = localStorage.getItem('selectedAvatar');
            if (savedAvatar) {
                document.getElementById('current-avatar').src = savedAvatar;
            }

            // –∑–∞–≥—Ä—É–∑–∫–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const username = localStorage.getItem('username');
            if (username) {
                document.getElementById('user-name').textContent = username;
            } else {
                document.getElementById('user-name').textContent = "–ì–æ—Å—Ç—å";
            }

            // –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const { data, error, count } = await supabase
                .from('stats')
                .select('*')
                .eq('user_id', supabase.auth.user().id)
                .limit(1); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π

            if (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                return;
            }

            if (data.length === 0) {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const { data: newStats, error: insertError } = await supabase
                    .from('stats')
                    .insert([
                        {
                            user_id: supabase.auth.user().id,
                            total_points: 0,
                            total_levels: 0,
                            flash_points: 0,
                            flash_levels: 0,
                            lost_points: 0,
                            lost_levels: 0,
                            pairs_points: 0,
                            pairs_levels: 0
                        }
                    ]);

                if (insertError) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', insertError);
                } else {
                    console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–±–∞–≤–ª–µ–Ω—ã!');
                    const userStats = newStats[0];
                    updateStats(userStats);
                }
            } else {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                const userStats = data[0];  // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å
                updateStats(userStats);
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updateStats(userStats) {
            document.getElementById('total-points').textContent = userStats.total_points;
            document.getElementById('total-levels').textContent = userStats.total_levels;

            document.getElementById('flash-points').textContent = userStats.flash_points;
            document.getElementById('flash-levels').textContent = userStats.flash_levels;

            document.getElementById('lost-points').textContent = userStats.lost_points;
            document.getElementById('lost-levels').textContent = userStats.lost_levels;

            document.getElementById('pairs-points').textContent = userStats.pairs_points;
            document.getElementById('pairs-levels').textContent = userStats.pairs_levels;
        }


    </script>
    
    
    

</body>
</html>
